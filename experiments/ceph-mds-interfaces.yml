# Author: Michael Sevilla
# Bring up Ceph with object interfaces on a single node

- hosts: all
  roles: [cleanup]

#- hosts: Builder
#  roles: [mantle-build]
#  vars:
#    - BUILD_THREADS: 64
#    - CEPH_PKGS: --with-mantle
#    #- GIT_URL: https://github.com/michaelsevilla/ceph.git
#    #- SHA1_OR_REF: remotes/origin/wip-mantle-dev
#    - GIT_URL: ""
#    - SHA1_OR_REF: ""

- hosts: Workers
  vars:  [STARTUP: "standalone.sh"]
  roles: [mantle, ceph-client]
  tasks:
    - command:  docker exec --detach ceph-client ceph-fuse /mnt/ -d
    - command:  docker exec ceph-client mdtest -F -C -n 1000 -d /mnt/testdir
      register: result
    - debug:    var=result.stdout_lines
