# Author: Michael Sevilla
# Bring up Ceph with object interfaces on a single node

- hosts: all
  roles: [cleanup]

- hosts: Builder
  roles:
    - role: ceph-build
      threads: "64"
      commit: "remotes/origin/infernalis"
      code_dir: "/tmp/docker/src/lua-rados"

- hosts: Workers
  roles: [{role: ceph, startup: "small.sh", code_dir: "/tmp/docker/src/lua-rados"}]

- hosts: Workers
  roles: [lua-rados]
  tasks:
    - command: docker exec lua-rados /bin/bash -c "LUA_CPATH=/lua-rados/.libs/rados.so busted lua-rados/test.lua"
      ignore_errors: True
      register: result
    - debug: var=result.stdout_lines
