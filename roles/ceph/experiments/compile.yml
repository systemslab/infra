# Author: Michael Sevilla
# Bring up Ceph and get its status

- name: cleanup old experiments
  hosts: all
  roles:
    - role: cleanup
      containers: "ceph client"

#- hosts: localhost
#  roles: [{role: ceph/build, threads: "64", commit: "remotes/origin/infernalis"}]

- name: Start Ceph using the "small.sh" startup script (roles/ceph/deploy/files/ceph-scripts/small.sh)
  hosts: Workers
  roles: [{role: ceph/deploy, startup: "small.sh"}]

- name: Get the status of the new Ceph cluster
  hosts: Clients
  roles: [{role: ceph/deploy, startup:   "none", container: "client", sshd_port: 2223}]
  tasks:
    - command:  docker exec client ceph -s
      register: result
      until:    result.stdout.find("HEALTH_OK") != -1
      retries:  120
    - debug:    var=result.stdout_lines
